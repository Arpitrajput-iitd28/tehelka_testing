<div class="app-layout">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed" [class.mobile-open]="mobileSidebarOpen">
    <div class="sidebar-header">
      <!-- Only show header content when NOT collapsed -->
      <ng-container *ngIf="!sidebarCollapsed">
        <div class="header-content" (click)="navigateToDashboard()">
          <img src="SpeedBenchLogo.png" alt="StressBench" class="sidebar-logo">
          <span class="sidebar-title">Veritas Load</span>
        </div>
      </ng-container>
      
      <!-- Collapse button - always visible -->
      <button class="sidebar-toggle-btn" (click)="toggleSidebar()">
        <img src="collapse.png" alt="Collapse" class="collapse-icon">
      </button>
    </div>
    
    <nav class="sidebar-nav">
      <!-- Dashboard -->
      <div class="nav-item">
        <a routerLink="/dashboard" class="nav-link" routerLinkActive="active">
          <img src="dashboard.png" alt="Dashboard" class="nav-icon">
          <span *ngIf="!sidebarCollapsed" class="nav-label">Dashboard</span>
        </a>
      </div>
      
      <!-- Tests CRUD Dropdown -->
        <div class="nav-item dropdown-container" [class.open]="testsDropdownOpen">
            <button class="nav-link dropdown-toggle" (click)="toggleTestsDropdown()" #testsButton>
                <img src="tests.png" alt="Tests" class="nav-icon">
                <span *ngIf="!sidebarCollapsed" class="nav-label">Tests</span>
                <img *ngIf="!sidebarCollapsed" src="dropdown.png" alt="Dropdown" class="dropdown-icon" 
                    [class.rotated]="testsDropdownOpen">
            </button>
            
            <!-- Normal dropdown for expanded sidebar -->
            <div class="dropdown-menu" *ngIf="testsDropdownOpen && !sidebarCollapsed" 
                [style.height]="testsDropdownOpen && !sidebarCollapsed ? 'auto' : '0'">
                <a routerLink="/tests/create" class="dropdown-item">
                    <img src="createtest.png" alt="Create" class="dropdown-item-icon">
                    <span>Create Test</span>
                </a>
                <a routerLink="/tests" class="dropdown-item">
                    <img src="viewtest.webp" alt="View" class="dropdown-item-icon">
                    <span>View All Tests</span>
                </a>
                <a routerLink="/tests/manage" class="dropdown-item">
                    <img src="managetest.png" alt="Manage" class="dropdown-item-icon">
                    <span>Manage Tests</span>
                </a>
            </div>
            
            <!-- Tooltip dropdown for collapsed sidebar -->
            <div class="tooltip-dropdown" *ngIf="testsDropdownOpen && sidebarCollapsed" 
                [style.top.px]="getButtonPosition('tests')">
                <div class="tooltip-content">
                    <span class="tooltip-title">Tests</span>
                    <a routerLink="/tests/create" class="tooltip-link">
                        <img src="createtest.png" alt="Create" class="tooltip-icon">
                        <span>Create Test</span>
                    </a>
                    <a routerLink="/tests" class="tooltip-link">
                        <img src="viewtest.webp" alt="View" class="tooltip-icon">
                        <span>View All Tests</span>
                    </a>
                    <a routerLink="/tests/manage" class="tooltip-link">
                        <img src="managetest.png" alt="Manage" class="tooltip-icon">
                        <span>Manage Tests</span>
                    </a>
                </div>
            </div>
        </div>
      
      <!-- Projects CRUD Dropdown -->
        <div class="nav-item dropdown-container" [class.open]="projectsDropdownOpen">
            <button class="nav-link dropdown-toggle" (click)="toggleProjectsDropdown()">
                <img src="projects.png" alt="Projects" class="nav-icon">
                <span *ngIf="!sidebarCollapsed" class="nav-label">Projects</span>
                <img *ngIf="!sidebarCollapsed" src="dropdown.png" alt="Dropdown" class="dropdown-icon" 
                    [class.rotated]="projectsDropdownOpen">
            </button>
    
            <!-- Normal dropdown for expanded sidebar -->
            <div class="dropdown-menu" *ngIf="projectsDropdownOpen && !sidebarCollapsed" 
                [style.height]="projectsDropdownOpen && !sidebarCollapsed ? 'auto' : '0'">
                <a routerLink="/projects/create" class="dropdown-item">
                <img src="createtest.png" alt="Create" class="dropdown-item-icon">
                <span>Create Project</span>
                </a>
                <a routerLink="/projects" class="dropdown-item">
                <img src="viewtest.webp" alt="View" class="dropdown-item-icon">
                <span>View Projects</span>
                </a>
                <a routerLink="/projects/manage" class="dropdown-item">
                <img src="managetest.png" alt="Manage" class="dropdown-item-icon">
                <span>Edit Projects</span>
                </a>
            </div>
    
            <!-- Tooltip dropdown for collapsed sidebar -->
            <div class="tooltip-dropdown" *ngIf="projectsDropdownOpen && sidebarCollapsed">
                <div class="tooltip-content">
                <span class="tooltip-title">Projects</span>
                <a routerLink="/projects/create" class="tooltip-link">
                    <img src="createtest.png" alt="Create" class="tooltip-icon">
                    <span>Create Project</span>
                </a>
                <a routerLink="/projects" class="tooltip-link">
                    <img src="viewtest.webp" alt="View" class="tooltip-icon">
                    <span>View Projects</span>
                </a>
                <a routerLink="/projects/manage" class="tooltip-link">
                    <img src="managetest.png" alt="Manage" class="tooltip-icon">
                    <span>Edit Projects</span>
                </a>
                </div>
            </div>
        </div>
      
      <!-- Reports -->
      <div class="nav-item">
        <a routerLink="/reports" class="nav-link" routerLinkActive="active">
          <img src="reports.png" alt="Reports" class="nav-icon">
          <span *ngIf="!sidebarCollapsed" class="nav-label">Reports</span>
        </a>
      </div>
      
      <!-- Schedules -->
      <div class="nav-item">
        <a routerLink="/schedules" class="nav-link" routerLinkActive="active">
          <img src="schedule.png" alt="Schedules" class="nav-icon">
          <span *ngIf="!sidebarCollapsed" class="nav-label">Schedules</span>
        </a>
      </div>
      
      <!-- Settings -->
      <div class="nav-item">
        <a routerLink="/settings" class="nav-link" routerLinkActive="active">
          <img src="settings.png" alt="Settings" class="nav-icon">
          <span *ngIf="!sidebarCollapsed" class="nav-label">Settings</span>
        </a>
      </div>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content" [class.sidebar-collapsed]="sidebarCollapsed">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <button class="mobile-menu-btn" (click)="toggleMobileSidebar()">
          <i class="fas fa-bars"></i>
        </button>
        <h1>{{ pageTitle }}</h1>
      </div>
      
      <div class="header-right">
        <!-- Search Bar -->
        <div class="search-container">
            <img src="search.png" alt="Search" class="search-icon-img">
            <input type="text" placeholder="Search..." [(ngModel)]="searchQuery">
        </div>
        
        <!-- Notification Bell -->
        <div class="notification-icon" [class.has-notifications]="notifications.length > 0" 
            (click)="toggleNotifications()">
            <div class="notification-bell-container">
                <img src="notif.png" alt="Notifications" class="notification-bell-img" >
                <span *ngIf="notifications.length > 0" class="notification-badge">{{notifications.length}}</span>
            </div>
        </div>
        
        <!-- User Menu -->
        <div class="user-menu" [class.open]="userMenuOpen">
          <button class="user-avatar" (click)="toggleUserMenu()">
            <img src="userav.png" alt="User Avatar">
            <span>{{currentUser.name}}</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          
          <div class="user-dropdown" *ngIf="userMenuOpen">
            <a routerLink="/profile" class="dropdown-item">
              <img src="profile.png" alt="Profile" class="menu-icon">
              <span>Profile</span>
            </a>
            <a routerLink="/settings" class="dropdown-item">
              <img src="settings.png" alt="Settings" class="menu-icon">
              <span>Settings</span>
            </a>
            <hr class="dropdown-divider">
            <button (click)="logout()" class="dropdown-item logout">
              <img src="logout.png" alt="Logout" class="menu-icon">
              <span>Logout</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <div class="page-content">
      <ng-content></ng-content>
    </div>
  </main>

  <!-- Notification Panel -->
  <div *ngIf="showNotifications" class="notification-panel">
    <div class="notification-header">
      <div class="notification-title">
        <div class="notification-icon-container">
          <img src="notif1.png" alt="Notifications" class="notification-icon-img">
          <span *ngIf="notifications.length > 0" class="notification-dot"></span>
        </div>
        <h3>Notifications</h3>
      </div>
      <button (click)="showNotifications = false" class="close-btn">×</button>
    </div>
    <div class="notification-list">
      <div *ngFor="let notification of notifications" class="notification-item" [class]="notification.type">
        <i class="fas" [class.fa-check-circle]="notification.type === 'success'" 
           [class.fa-exclamation-triangle]="notification.type === 'warning'"
           [class.fa-times-circle]="notification.type === 'error'"></i>
        <div class="notification-content">
          <p>{{notification.message}}</p>
          <small>{{notification.timestamp | date:'short'}}</small>
        </div>
        <button (click)="dismissNotification(notification.id)" class="dismiss-btn">×</button>
      </div>
      <!-- Placeholder when no notifications -->
      <div *ngIf="notifications.length === 0" class="no-notifications">
        <img src="nonotif.png" alt="No notifications">
        <p>No new notifications</p>
        <small>You're all caught up!</small>
      </div>
    </div>
  </div>

  <!-- Mobile Sidebar Overlay -->
  <div *ngIf="mobileSidebarOpen" class="mobile-overlay" (click)="closeMobileSidebar()"></div>
</div>
